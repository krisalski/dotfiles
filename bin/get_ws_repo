#!/bin/bash
ip=$(dig a +noall +answer $1 | awk '{print $5}')
nginx_files=$(ssh -q deploy@$ip 'ls /etc/nginx/sites-enabled')

wanted_file=''

for nginx_file in $nginx_files; do
  if [[ "$nginx_file" == "000-default" || "$nginx_file" == "nginx_status" ]]; then
    continue
  fi
  wanted_file=$nginx_file
  check=$(ssh -q deploy@$ip "cat /etc/nginx/sites-enabled/$nginx_file | grep $1")
  if [[ "$check" != "" ]]; then
    break
  fi
done

app_path=$(ssh -q deploy@$ip "cat /etc/nginx/sites-enabled/$wanted_file | grep /current/public" | awk '{print $2}' | xargs dirname)
repo=$(ssh -q deploy@$ip "cat $app_path/config/deploy.rb | grep ':repository,'" | awk '{print $3}' | tr -d "\'\"")
echo $repo
